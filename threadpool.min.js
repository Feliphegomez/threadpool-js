"function"!=typeof Worker&&console&&console.log("Warning: Browser does not support web workers."),function(){function a(a,b){return!(b>a||a>b)}function b(a,b){if("function"!=typeof b)throw new Error("Expected callback function as parameter.");for(var c=0;c<a.length;c++){var d=a[c];if(d==b)return}a.push(b)}function c(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.apply(null,b)}}var d="this.onmessage = function (event) {    var fnData = event.data.function;    var scripts = event.data.importScripts;    var fn = Function.apply(null, fnData.args.concat(fnData.body));    if(importScripts && importScripts.length > 0) {        importScripts.apply(null, scripts);    }    fn(event.data.parameter, function(result) {        postMessage(result);    });}",e="data:text/javascript;charset=utf-8,"+encodeURI(d),f=window.createBlobURL||window.createObjectURL;if(!f&&window.webkitURL&&(f=window.webkitURL.createObjectURL),"function"==typeof BlobBuilder&&"function"==typeof f){var g=new BlobBuilder;g.append(d),e=f(g.getBlob())}else if("function"==typeof Blob&&"function"==typeof f){var h=new Blob([d],{type:"text/javascript"});e=f(h)}var i=function(a,b){if(this.param=b,this.importScripts=[],this.callbacksDone=[],this.callbacksError=[],"function"==typeof a){var c=a.toString();this.scriptArgs=c.substring(c.indexOf("(")+1,c.indexOf(")")).split(","),this.scriptBody=c.substring(c.indexOf("{")+1,c.lastIndexOf("}")),this.scriptFile=void 0}else this.scriptArgs=void 0,this.scriptBody=void 0,this.scriptFile=a};i.prototype={getParameter:function(){return this.param},setParameter:function(a){this.param=a},getImportScripts:function(){return this.importScripts},setImportScripts:function(a){this.importScripts=a},getFunction:function(){return this.scriptArgs?{args:this.scriptArgs,body:this.scriptBody}:void 0},getScriptFile:function(){return this.scriptFile},functionallyEquals:function(b){return b&&b instanceof i&&a(b.scriptArgs,this.scriptArgs)&&b.body==this.body&&b.scriptFile==this.scriptFile},triggerDone:function(a){c(this.callbacksDone,[a])},triggerError:function(a){c(this.callbacksError,[a])},done:function(a){return b(this.callbacksDone,a),this},error:function(a){return b(this.callbacksError,a),this}};var j=function(a){this.threadPool=a,this.worker=void 0,this.currentJob=void 0,this.lastJob=void 0};j.prototype={run:function(a){function b(a){f.currentJob.triggerDone(a.data),f.threadPool.triggerDone(a.data),d()}function c(a){f.currentJob.triggerError(a),f.threadPool.triggerError(a),d()}function d(){f.currentJob=void 0,f.lastJob=a,f.threadPool._threadDone(f)}var f=this,g=!0;this.currentJob=a,this.worker&&(this.lastJob&&this.lastJob.functionallyEquals(a)?g=!1:(this.worker.terminate(),this.worker=void 0)),a.getScriptFile()?(g&&(this.worker=new Worker(a.getScriptFile()),this.worker.addEventListener("message",b,!1),this.worker.addEventListener("error",c,!1)),this.worker.postMessage(a.getParameter())):(g&&(this.worker=new Worker(e),this.worker.addEventListener("message",b,!1),this.worker.addEventListener("error",c,!1)),this.worker.postMessage({"function":a.getFunction(),importScripts:a.getImportScripts(),parameter:a.getParameter()}))}};var k=function(a){a=a||k.defaultSize,this.size=a,this.pendingJobs=[],this.idleThreads=[],this.callbacksDone=[],this.callbacksError=[];for(var b=0;a>b;b++)this.idleThreads.push(new j(this))};k.prototype={run:function(){var a,b,c,d,e,f=[].slice.call(arguments);if(arguments.length<1)throw new Error("run(): Too less parameters.");if("string"==typeof f[0])a=f.shift();else{if("object"==typeof f[0]&&f[0]instanceof Array&&(c=f.shift()),!(f.length>0&&"function"==typeof f[0]))throw new Error("run(): Missing obligatory thread logic function.");b=f.shift()}if(f.length>0&&"function"!=typeof f[0]&&(d=f.shift()),f.length>0&&"function"==typeof f[0]&&(e=f.shift()),f.length>0)throw new Error("run(): Unrecognized parameters: "+f);var g;return a?g=new i(a,d):(g=new i(b,d),c&&c.length>0&&g.setImportScripts(c)),e&&g.done(e),this.pendingJobs.push(g),this.runJobs(),g},runJobs:function(){if(this.idleThreads.length>0&&this.pendingJobs.length>0){var a=this.idleThreads.shift(),b=this.pendingJobs.shift();a.run(b)}},_threadDone:function(a){this.idleThreads.push(a),this.runJobs()},triggerDone:function(a){c(this.callbacksDone,[a])},triggerError:function(a){c(this.callbacksError,[a])},done:function(a){return b(this.callbacksDone,a),this},error:function(a){return b(this.callbacksError,a),this}},k.defaultSize=8,"function"==typeof define?define([],k):"object"==typeof window&&(window.ThreadPool=k)}();